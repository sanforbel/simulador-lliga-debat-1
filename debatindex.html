<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lliga de Debat - Xarxa Llu√≠s Vives</title>
    <!--
    Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
    https://creativecommons.org/licenses/by-nc-sa/4.0/

    Autora: Sandra Fortanet Beltran

    Aquest projecte es distribueix sota la llic√®ncia CC BY-NC-SA 4.0, que permet:

    - Compartir ‚Äî copiar i redistribuir el material en qualsevol mitj√† i format.
    - Adaptar ‚Äî remesclar, transformar i construir a partir del material.

    Sota les condicions seg√ºents:

    - Atribuci√≥ ‚Äî S'ha de recon√®ixer l'autoria.
    - No Comercial ‚Äî No es pot utilitzar amb finalitats comercials.
    - Compartir Igual ‚Äî Les obres derivades han de tenir la mateixa llic√®ncia.

    Per a qualsevol √∫s diferent, cal autoritzaci√≥ expl√≠cita.
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <noscript>Necessites habilitar JavaScript per executar aquesta aplicaci√≥.</noscript>
    <div id="root"></div>

    <!-- React i ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel per transformar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        // Main App component for the debate practice application
        const App = () => {
            // State variables for the application
            const [currentPhase, setCurrentPhase] = React.useState('inici'); // Current debate phase
            const [selectedTopic, setSelectedTopic] = React.useState(''); // The topic chosen for the debate
            const [timer, setTimer] = React.useState(0); // Timer for the current phase
            const [isRunning, setIsRunning] = React.useState(false); // Flag to control timer
            const [isRecording, setIsRecording] = React.useState(false); // Flag for voice recording
            const [userTranscript, setUserTranscript] = React.useState(''); // User's recorded speech converted to text
            const [aiResponse, setAiResponse] = React.useState('Esperant la teva intervenci√≥...'); // AI opponent's response
            const [evaluationFeedback, setEvaluationFeedback] = React.useState(''); // Feedback from automatic evaluation

            // Predefined debate phases with their estimated durations based on Xarxa Vives regulations
            const phases = {
                'inici': { name: 'Inici', duration: 0 }, // Initial state
                'presentacio': { name: 'Presentaci√≥ (Preparaci√≥ de l\'equip)', duration: 60 }, // 1 minute for general preparation
                'exposicio_inicial_af': { name: 'Exposici√≥ Inicial (A Favor)', duration: 5 * 60 }, // 5 minutes
                'exposicio_inicial_ec': { name: 'Exposici√≥ Inicial (En Contra)', duration: 5 * 60 }, // 5 minutes
                'refutacio_1_af': { name: 'Refutaci√≥ 1 (A Favor)', duration: 4 * 60 }, // 4 minutes
                'refutacio_1_ec': { name: 'Refutaci√≥ 1 (En Contra)', duration: 4 * 60 }, // 4 minutes
                'refutacio_2_af': { name: 'Refutaci√≥ 2 (A Favor)', duration: 4 * 60 }, // 4 minutes
                'refutacio_2_ec': { name: 'Refutaci√≥ 2 (En Contra)', duration: 4 * 60 }, // 4 minutes
                'conclusions_ec': { name: 'Conclusions (En Contra)', duration: 3 * 60 }, // 3 minutes
                'conclusions_af': { name: 'Conclusions (A Favor)', duration: 3 * 60 }, // 3 minutes
                'final': { name: 'Final', duration: 0 } // End state
            };

            // List of debate topics, including the specific one requested
            const topics = [
                'La joventut √©s cada vegada m√©s masclista.',
                'La intel¬∑lig√®ncia artificial √©s una amena√ßa per a la creativitat humana.',
                '√âs necess√†ria la prohibici√≥ dels vehicles de combusti√≥ a les ciutats?',
                'Les xarxes socials fan m√©s b√© que mal a la societat?',
                'El sistema educatiu actual prepara adequadament els joves per al futur laboral?',
                'La globalitzaci√≥ afavoreix o perjudica la diversitat cultural?',
                'Haurien de ser obligat√≤ries les vacunes per a totes les malalties?',
                'El consum de carn hauria de ser desincentivat per raons √®tiques i ambientals.',
            ];

            // Ref for the media recorder, to handle voice recording
            const mediaRecorderRef = React.useRef(null);
            const audioChunksRef = React.useRef([]);

            // Effect hook for the timer functionality
            React.useEffect(() => {
                let interval = null;
                if (isRunning && timer > 0) {
                    interval = setInterval(() => {
                        setTimer((prevTimer) => prevTimer - 1);
                    }, 1000);
                } else if (timer === 0 && isRunning) {
                    // Timer finished, stop it and potentially move to next phase
                    setIsRunning(false);
                    console.log(`Fase ${phases[currentPhase].name} finalitzada.`);
                    // Automatically move to the next phase after a short delay
                    setTimeout(() => {
                        goToNextPhase();
                    }, 1000); // 1 second delay before moving to next phase
                }
                return () => clearInterval(interval); // Cleanup interval on component unmount or state change
            }, [isRunning, timer, currentPhase, phases]); // Added phases to dependency array

            // Function to start the debate with a selected topic
            const startDebate = (topic) => {
                setSelectedTopic(topic);
                setCurrentPhase('presentacio'); // Start with the presentation phase
                setTimer(phases['presentacio'].duration);
                setIsRunning(true); // Start the timer
                setAiResponse('L\'equip contrari est√† preparant la seva presentaci√≥...'); // Reset AI response
                setUserTranscript(''); // Clear previous transcript
                setEvaluationFeedback(''); // Clear previous feedback
            };

            // Function to pick a random topic from the list
            const pickRandomTopic = () => {
                const randomIndex = Math.floor(Math.random() * topics.length);
                const topic = topics[randomIndex];
                startDebate(topic);
            };

            // Function to handle phase progression
            const goToNextPhase = () => {
                const phaseKeys = Object.keys(phases);
                const currentIndex = phaseKeys.indexOf(currentPhase);
                if (currentIndex < phaseKeys.length - 1) {
                    const nextPhaseKey = phaseKeys[currentIndex + 1];
                    setCurrentPhase(nextPhaseKey);
                    setTimer(phases[nextPhaseKey].duration);
                    setIsRunning(true);
                    setAiResponse('Esperant la intervenci√≥ de l\'equip contrari...'); // Reset AI response
                    setUserTranscript(''); // Clear previous transcript
                    setEvaluationFeedback(''); // Clear previous feedback

                    // Simulate AI response after a short delay for demonstration
                    // AI responds if it's an 'En Contra' turn
                    if (nextPhaseKey.includes('_ec')) {
                        setTimeout(() => {
                            simulateAiResponse(nextPhaseKey);
                        }, 3000); // Simulate AI thinking time
                    }
                } else {
                    setCurrentPhase('final');
                    setIsRunning(false);
                    setAiResponse('El debat ha finalitzat. Revisem l\'avaluaci√≥.');
                    // Trigger final evaluation here
                    simulateEvaluation();
                }
            };

            // Function to simulate AI response (placeholder for actual LLM integration)
            const simulateAiResponse = async (phase) => {
                setAiResponse('L\'IA est√† generant la seva resposta...');
                // In a real application, you would call a Gemini API here to get a generated response
                // Example:
                // const prompt = `Simula la resposta d'un oponent en un debat sobre "${selectedTopic}" durant la fase de ${phases[phase].name}. El meu √∫ltim argument ha estat: "${userTranscript}".`;
                // const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                // const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                // const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                // const response = await fetch(apiUrl, {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(payload)
                // });
                // const result = await response.json();
                // if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                //     const aiGeneratedText = result.candidates[0].content.parts[0].text;
                //     setAiResponse(aiGeneratedText);
                // } else {
                //     setAiResponse('Error en generar la resposta de l\'IA.');
                // }


                setTimeout(() => {
                    let simulatedText = '';
                    switch (phase) {
                        case 'presentacio':
                            simulatedText = 'Bon dia a tots. El nostre equip defensar√† la postura contr√†ria al tema proposat, buscant desmuntar la idea que la joventut √©s cada vegada m√©s masclista. Estem preparats per al debat.';
                            break;
                        case 'exposicio_inicial_ec':
                            simulatedText = 'Com a equip en contra, la nostra exposici√≥ inicial es centrar√† en evid√®ncies que demostren un augment de la consci√®ncia feminista entre els joves i una disminuci√≥ de les actituds masclistes respecte a generacions anteriors, posant √®mfasi en el paper de l\'educaci√≥ i les xarxes socials com a vehicles de canvi positiu.';
                            break;
                        case 'refutacio_1_ec':
                            simulatedText = 'La vostra afirmaci√≥ sobre un suposat augment del masclisme juvenil ignora les dades que mostren una reducci√≥ de les actituds sexistes en enquestes recents. A m√©s, confoneu la visibilitat de certes conductes amb la seva prevalen√ßa real. Les dades indiquen una tend√®ncia a la baixa del masclisme entre les noves generacions.';
                            break;
                        case 'refutacio_2_ec':
                            simulatedText = 'Insistim que els casos a√Øllats de masclisme juvenil que es fan virals no representen la totalitat de la joventut. La majoria dels joves estan compromesos amb la igualtat i rebutgen activament les actituds masclistes. Cal analitzar les dades amb rigor i no basar-se en percepcions subjectives.';
                            break;
                        case 'conclusions_ec':
                            simulatedText = 'En conclusi√≥, l\'equip en contra ha demostrat que la joventut actual no √©s m√©s masclista. Al contrari, est√† liderant un canvi de paradigma cap a una societat m√©s igualit√†ria, amb una implicaci√≥ activa en la lluita contra les desigualtats de g√®nere. La nostra posici√≥ ha estat fonamentada en dades i una an√†lisi cr√≠tica de la realitat.';
                            break;
                        default:
                            simulatedText = 'L\'IA ha respost en aquesta fase.';
                    }
                    setAiResponse(simulatedText);
                }, 2000); // Simulate network delay
            };

            // Function to simulate evaluation (placeholder for actual rubric integration)
            const simulateEvaluation = async () => {
                setEvaluationFeedback('Analitzant la teva actuaci√≥...');
                // In a real application, you would use a Gemini API call with a structured response schema
                // to evaluate the user's transcript against a rubric.
                // Example:
                // const prompt = `Avalua el seg√ºent text de debat "${userTranscript}" segons la r√∫brica de la Lliga de Debat de la Xarxa Llu√≠s Vives per a la fase de ${phases[currentPhase].name}. Proporciona feedback constructiu.`;
                // const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                // const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                // const payload = {
                //     contents: [{ role: "user", parts: [{ text: prompt }] }],
                //     generationConfig: {
                //         responseMimeType: "application/json",
                //         responseSchema: { /* your JSON schema based on rubric */ }
                //     }
                // };
                // const response = await fetch(apiUrl, {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(payload)
                // });
                // const result = await response.json();
                // if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                //     const json = result.candidates[0].content.parts[0].text;
                //     const parsedJson = JSON.parse(json);
                //     setEvaluationFeedback(JSON.stringify(parsedJson, null, 2)); // Format as needed
                // } else {
                //     setEvaluationFeedback('Error en generar l\'avaluaci√≥ de l\'IA.');
                // }


                setTimeout(() => {
                    setEvaluationFeedback(
                        `Avaluaci√≥ simulada: Has fet una bona feina en l'estructura de la teva intervenci√≥. Per millorar, intenta aprofundir m√©s en els teus arguments amb exemples concrets i estad√≠stiques. La teva dicci√≥ √©s clara, per√≤ podries modular m√©s la veu per emfatitzar punts clau. Has respectat el temps assignat.`
                    );
                }, 3000); // Simulate evaluation time
            };

            // Function to start voice recording
            const startRecording = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    audioChunksRef.current = [];

                    mediaRecorderRef.current.ondataavailable = (event) => {
                        audioChunksRef.current.push(event.data);
                    };

                    mediaRecorderRef.current.onstop = async () => {
                        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                        // Here you would send the audioBlob to a speech-to-text API (e.g., Google Cloud Speech-to-Text)
                        // For now, we'll simulate the transcription
                        console.log('Audio recorded:', audioBlob);
                        setIsRecording(false);
                        simulateSpeechToText(audioBlob);
                    };

                    mediaRecorderRef.current.start();
                    setIsRecording(true);
                    setUserTranscript('Gravant la teva veu...');
                } catch (error) {
                    console.error('Error accedint al micr√≤fon:', error);
                    // Using a custom message box instead of alert()
                    const messageBox = document.createElement('div');
                    messageBox.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    messageBox.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                            <p class="text-lg font-semibold mb-4">Error</p>
                            <p>No s'ha pogut accedir al micr√≤fon. Assegura't de donar permisos.</p>
                            <button class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full" onclick="this.parentNode.parentNode.remove()">Ent√®s</button>
                        </div>
                    `;
                    document.body.appendChild(messageBox);
                }
            };

            // Function to stop voice recording
            const stopRecording = () => {
                if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {
                    mediaRecorderRef.current.stop();
                }
            };

            // Function to simulate speech-to-text (placeholder for actual API call)
            const simulateSpeechToText = async (audioBlob) => {
                setUserTranscript('Convertint veu a text...');
                // In a real application, you would send the audioBlob to a speech-to-text API
                // and get the transcribed text back.
                // Example:
                // const base64Audio = await audioBlobToBase64(audioBlob);
                // const transcribedText = await callSpeechToTextApi(base64Audio);
                // setUserTranscript(transcribedText);

                setTimeout(() => {
                    const simulatedText = "Aquesta √©s una transcripci√≥ simulada de la teva veu. Aqu√≠ aniria el teu argument complet.";
                    setUserTranscript(simulatedText);
                    // After user finishes speaking, AI can respond or evaluation can happen
                    // This is handled by the timer's useEffect which calls goToNextPhase when timer hits 0
                }, 3000); // Simulate transcription time
            };

            // Helper to format time for display (MM:SS)
            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            };

            // Render the main application UI
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col items-center justify-center p-4 sm:p-6 md:p-8 font-inter text-gray-800">
                    <div className="bg-white rounded-3xl shadow-xl p-6 sm:p-8 md:p-10 w-full max-w-4xl border border-blue-200">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-center text-indigo-700 mb-6 sm:mb-8 tracking-tight">
                            <span className="block">Lliga de Debat</span>
                            <span className="block text-2xl sm:text-3xl text-blue-500 mt-2">Xarxa Llu√≠s Vives</span>
                        </h1>

                        {/* License Information */}
                        <div className="text-center text-xs text-gray-400 mb-8">
                            <p>
                                Aquest projecte es distribueix sota la llic√®ncia
                                <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:underline ml-1">
                                    Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
                                </a>.
                            </p>
                            <p>Autora: Sandra Fortanet Beltran</p>
                        </div>

                        {/* Debate Phases Summary SVG */}
                        <div className="w-full mb-8 overflow-x-auto">
                            <h2 className="text-xl sm:text-2xl font-semibold text-gray-700 mb-4 text-center">Fases i Temps del Debat (Reglament Xarxa Vives)</h2>
                            <svg viewBox="0 0 1200 200" className="w-full h-auto">
                                <defs>
                                    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style={{stopColor: '#6366F1', stopOpacity: 1}} />
                                        <stop offset="100%" style={{stopColor: '#8B5CF6', stopOpacity: 1}} />
                                    </linearGradient>
                                    <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style={{stopColor: '#3B82F6', stopOpacity: 1}} />
                                        <stop offset="100%" style={{stopColor: '#2563EB', stopOpacity: 1}} />
                                    </linearGradient>
                                    <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style={{stopColor: '#EF4444', stopOpacity: 1}} />
                                        <stop offset="100%" style={{stopColor: '#DC2626', stopOpacity: 1}} />
                                    </linearGradient>
                                </defs>

                                {/* Background for the timeline */}
                                <rect x="50" y="70" width="1100" height="60" fill="#E0E7FF" rx="10" ry="10" />

                                {/* Timeline line */}
                                <line x1="50" y1="100" x2="1150" y2="100" stroke="#6366F1" strokeWidth="4" strokeDasharray="8 8" />

                                {/* Phases */}
                                {/* Presentation */}
                                <rect x="50" y="80" width="100" height="40" fill="url(#grad1)" rx="8" ry="8" />
                                <text x="100" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Presentaci√≥</text>
                                <text x="100" y="115" textAnchor="middle" fontSize="14" fill="white">1 min</text>
                                <text x="100" y="145" textAnchor="middle" fontSize="12" fill="#4F46E5">Preparaci√≥</text>

                                {/* Exposici√≥ Inicial AF */}
                                <rect x="200" y="80" width="100" height="40" fill="url(#grad2)" rx="8" ry="8" />
                                <text x="250" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Exp. Inicial AF</text>
                                <text x="250" y="115" textAnchor="middle" fontSize="14" fill="white">5 min</text>
                                <text x="250" y="145" textAnchor="middle" fontSize="12" fill="#2563EB">Equip A Favor</text>

                                {/* Exposici√≥ Inicial EC */}
                                <rect x="350" y="80" width="100" height="40" fill="url(#grad3)" rx="8" ry="8" />
                                <text x="400" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Exp. Inicial EC</text>
                                <text x="400" y="115" textAnchor="middle" fontSize="14" fill="white">5 min</text>
                                <text x="400" y="145" textAnchor="middle" fontSize="12" fill="#DC2626">Equip En Contra</text>

                                {/* Refutaci√≥ 1 AF */}
                                <rect x="500" y="80" width="80" height="40" fill="url(#grad2)" rx="8" ry="8" />
                                <text x="540" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Ref. 1 AF</text>
                                <text x="540" y="115" textAnchor="middle" fontSize="14" fill="white">4 min</text>
                                <text x="540" y="145" textAnchor="middle" fontSize="12" fill="#2563EB">Equip A Favor</text>

                                {/* Refutaci√≥ 1 EC */}
                                <rect x="630" y="80" width="80" height="40" fill="url(#grad3)" rx="8" ry="8" />
                                <text x="670" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Ref. 1 EC</text>
                                <text x="670" y="115" textAnchor="middle" fontSize="14" fill="white">4 min</text>
                                <text x="670" y="145" textAnchor="middle" fontSize="12" fill="#DC2626">Equip En Contra</text>

                                {/* Refutaci√≥ 2 AF */}
                                <rect x="760" y="80" width="80" height="40" fill="url(#grad2)" rx="8" ry="8" />
                                <text x="800" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Ref. 2 AF</text>
                                <text x="800" y="115" textAnchor="middle" fontSize="14" fill="white">4 min</text>
                                <text x="800" y="145" textAnchor="middle" fontSize="12" fill="#2563EB">Equip A Favor</text>

                                {/* Refutaci√≥ 2 EC */}
                                <rect x="890" y="80" width="80" height="40" fill="url(#grad3)" rx="8" ry="8" />
                                <text x="930" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Ref. 2 EC</text>
                                <text x="930" y="115" textAnchor="middle" fontSize="14" fill="white">4 min</text>
                                <text x="930" y="145" textAnchor="middle" fontSize="12" fill="#DC2626">Equip En Contra</text>

                                {/* Conclusions EC */}
                                <rect x="1020" y="80" width="60" height="40" fill="url(#grad3)" rx="8" ry="8" />
                                <text x="1050" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Conc. EC</text>
                                <text x="1050" y="115" textAnchor="middle" fontSize="14" fill="white">3 min</text>
                                <text x="1050" y="145" textAnchor="middle" fontSize="12" fill="#DC2626">Equip En Contra</text>

                                {/* Conclusions AF */}
                                <rect x="1100" y="80" width="60" height="40" fill="url(#grad2)" rx="8" ry="8" />
                                <text x="1130" y="95" textAnchor="middle" fontSize="16" fontWeight="bold" fill="white">Conc. AF</text>
                                <text x="1130" y="115" textAnchor="middle" fontSize="14" fill="white">3 min</text>
                                <text x="1130" y="145" textAnchor="middle" fontSize="12" fill="#2563EB">Equip A Favor</text>
                            </svg>
                        </div>

                        {/* Initial Screen / Topic Selection */}
                        {currentPhase === 'inici' && (
                            <div className="text-center">
                                <p className="text-lg sm:text-xl text-gray-700 mb-6">
                                    Benvinguda a l'aplicaci√≥ per practicar el debat!
                                </p>
                                <button
                                    onClick={pickRandomTopic}
                                    className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300 mb-4 text-lg"
                                >
                                    <span className="mr-2">üé≤</span> Tria un Tema Aleatori
                                </button>
                                <p className="text-sm text-gray-500 mt-2">
                                    Un dels temes pot ser: "La joventut √©s cada vegada m√©s masclista."
                                </p>
                            </div>
                        )}

                        {/* Debate Interface */}
                        {currentPhase !== 'inici' && (
                            <>
                                <div className="bg-blue-50 rounded-xl p-4 sm:p-6 mb-6 border border-blue-200">
                                    <h2 className="text-2xl sm:text-3xl font-semibold text-blue-700 mb-3 text-center">
                                        Tema del Debat: <span className="font-bold">{selectedTopic}</span>
                                    </h2>
                                    <div className="flex flex-col sm:flex-row justify-between items-center text-lg sm:text-xl font-medium text-blue-600">
                                        <p className="mb-2 sm:mb-0">Fase Actual: <span className="font-bold">{phases[currentPhase].name}</span></p>
                                        <p>Temps Restant: <span className="font-bold text-indigo-600">{formatTime(timer)}</span></p>
                                    </div>
                                </div>

                                {/* User's Turn Section */}
                                <div className="bg-gray-50 rounded-xl p-4 sm:p-6 mb-6 border border-gray-200">
                                    <h3 className="text-xl sm:text-2xl font-semibold text-gray-700 mb-4">La Teva Intervenci√≥</h3>
                                    <div className="flex flex-col sm:flex-row gap-4 mb-4">
                                        <button
                                            onClick={isRecording ? stopRecording : startRecording}
                                            className={`flex-1 ${isRecording ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'} text-white font-bold py-2 px-4 rounded-full shadow-md transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-4 ${isRecording ? 'focus:ring-red-300' : 'focus:ring-green-300'}`}
                                        >
                                            {isRecording ? 'üõë Atura la Gravaci√≥' : 'üéôÔ∏è Grava la Teva Veu'}
                                        </button>
                                        {/* The "Next Phase" button is now primarily for manual progression or debugging,
                                            as the timer will automatically advance phases. */}
                                        <button
                                            onClick={goToNextPhase}
                                            disabled={currentPhase === 'final'}
                                            className="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Seg√ºent Fase ‚ñ∂Ô∏è
                                        </button>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg border border-gray-300 min-h-[80px] overflow-auto">
                                        <p className="text-gray-700 italic">{userTranscript || 'El text de la teva veu apareixer√† aqu√≠...'}</p>
                                    </div>
                                </div>

                                {/* AI Opponent's Section */}
                                <div className="bg-gray-50 rounded-xl p-4 sm:p-6 mb-6 border border-gray-200">
                                    <h3 className="text-xl sm:text-2xl font-semibold text-gray-700 mb-4">Intervenci√≥ de l'Oponent (IA)</h3>
                                    <div className="bg-white p-4 rounded-lg border border-gray-300 min-h-[120px] overflow-auto">
                                        <p className="text-gray-700">{aiResponse}</p>
                                    </div>
                                </div>

                                {/* Evaluation Section */}
                                <div className="bg-yellow-50 rounded-xl p-4 sm:p-6 border border-yellow-200">
                                    <h3 className="text-xl sm:text-2xl font-semibold text-yellow-700 mb-4">Avaluaci√≥ i Feedback</h3>
                                    <div className="bg-white p-4 rounded-lg border border-yellow-300 min-h-[100px] overflow-auto">
                                        <p className="text-gray-700">{evaluationFeedback || 'El feedback de l\'avaluaci√≥ autom√†tica apareixer√† aqu√≠.'}</p>
                                    </div>
                                </div>

                                {currentPhase === 'final' && (
                                    <div className="text-center mt-8">
                                        <button
                                            onClick={() => setCurrentPhase('inici')}
                                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg"
                                        >
                                            Comen√ßa un Nou Debat
                                        </button>
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Render the App component into the 'root' div
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
